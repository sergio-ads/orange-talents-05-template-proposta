package br.com.zupacademy.proposta.model.request;

import br.com.zupacademy.proposta.model.Proposta;
import br.com.zupacademy.proposta.model.enums.ResultadoSolicitacao;
import br.com.zupacademy.proposta.validator.CpfOrCnpj;
import br.com.zupacademy.proposta.validator.NaoExiste;

import javax.validation.constraints.Email;
import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotNull;
import javax.validation.constraints.PositiveOrZero;
import java.math.BigDecimal;

public class PropostaRequest {
    @NotBlank
    @CpfOrCnpj
    @NaoExiste(domainClass = Proposta.class, fieldName = "cpfOuCnpj")
    private final String cpfOuCnpj;
    @NotBlank
    @Email
    private final String email;
    @NotBlank
    private final String nome;
    @NotBlank
    private final String endereco;
    @NotNull
    @PositiveOrZero
    private final BigDecimal salario;

    public PropostaRequest(@NotBlank String cpfOuCnpj, @NotBlank @Email String email, @NotBlank String nome,
			@NotBlank String endereco, @NotNull @PositiveOrZero BigDecimal salario) {
		this.cpfOuCnpj = cpfOuCnpj.replaceAll("\\D", "");
		this.email = email;
		this.nome = nome;
		this.endereco = endereco;
		this.salario = salario;
	}

	public Proposta toModel() {
		ResultadoAvaliacao resultadoAvaliacao = requisicao.post(endereco).body(novaProposta.getDocumento()).execute();
        return new Proposta(cpfOuCnpj, email, nome, endereco, salario, resultadoAvaliacao);
    }

}
