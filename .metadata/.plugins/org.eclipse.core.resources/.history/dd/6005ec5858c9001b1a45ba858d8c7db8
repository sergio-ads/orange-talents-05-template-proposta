package br.com.zupacademy.proposta.scheduler;

import java.util.Set;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Configuration;
import org.springframework.scheduling.annotation.EnableAsync;
import org.springframework.scheduling.annotation.EnableScheduling;
import org.springframework.scheduling.annotation.Scheduled;

import br.com.zupacademy.proposta.consumer.CartoesClient;
import br.com.zupacademy.proposta.consumer.response.CartoesResponse;
import br.com.zupacademy.proposta.model.Proposta;
import br.com.zupacademy.proposta.repository.PropostaRepository;

@Configuration
@EnableAsync
@EnableScheduling
public class CartaoScheduler {

    @Autowired
    private PropostaRepository propostaRepository;	
    @Autowired
    private CartoesClient cartoesClient;
	
	@Scheduled(fixedDelay=10000)
	public void buscarCartoes() {
		
		Set<Proposta> propostas = propostaRepository.findByCartao(null);
		for (Proposta proposta : propostas) {
			CartoesResponse cartoesResponse = cartoesClient
					.getCartoes(proposta.getId());
			System.out.println(proposta);
			System.out.println("    cartoes: " +cartoesResponse.getId());
		}
		
	}

}
